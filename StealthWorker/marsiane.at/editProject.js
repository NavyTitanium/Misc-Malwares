$(document).ready(function (e) {
    loadProjectLog();
    updateProgressBar();
    setInterval(function(){ updateProgressBar(); }, 15000);
    setInterval(function(){ loadProjectLog(); }, 15000);
});

function loadProjectLog() {
    var projId = getUrlParameter("projectID");
    $.ajax({
        url: "/stats/loadLog?projectId=" + projId,
        type: "GET",

        success: function(data)
        {
            var obj = jQuery.parseJSON(data);
            res = "";
            $.each(obj, function( index, value ) {
                res = res + value;
            });
            $("#ProjectLog").val(res);
        },
    });
}

function updateProgressBar() {
    var projId = getUrlParameter("projectID");
    $.ajax({
        url: "/project/info?projectId=" + projId,
        type: "GET",

        success: function(data)
        {
            // $('#fileName').text = data;
            var obj = jQuery.parseJSON(data);
            // alert(obj.CurrentProgress);
            $("#progress2").text(obj.PercentProgress);
            $('#progress1').attr('aria-valuenow', obj.PercentProgress).css('width', obj.PercentProgress);
            $('#progressCompl').text(obj.CurrentProgressStr);
            $('#progressMax').text(obj.MaxProgressStr);
            $('#goods').text(obj.GoodsStr);
        },
    });
}

var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};
