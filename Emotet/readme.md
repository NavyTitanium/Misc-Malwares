On infected WordPress sites, the following files are always present:
```
#ls -la /home/<web user>/public_html/<website>/<infected directory>
drwxr-xr-x 2 <web user> <web user>   4096 Oct 16 03:42 .
drwxr-xr-x 4 <web user> <web user>   4096 Oct 16 16:26 ..
-rw-r--r-- 1 <web user> <web user>      7 Oct 16 16:42 .2d52cebe504208dd775597d6411eaf21af00f04b
-rw-r--r-- 1 <web user> <web user>     95 Oct 16 16:43 .htaccess
-rw-r--r-- 1 <web user> <web user> 204144 Oct 16 16:43 index.php
```
In this example, if the name of the infected directory is **v4A1d**, a file named **.2d52cebe504208dd775597d6411eaf21af00f04b** will be created (sha1(basename($contentPath))). 

The **index.php** contains the payload that will be sent to the client after ***gzinflate(base64_decode())***

**import.php** is the backdoor found one directory up the infected path (the name of the WebShell varies). It is use to receive commands type 1 and 2 via POST requests. They're using the popular [WSO webshell](https://github.com/tennc/webshell/blob/master/php/wso/wso2.php). The password for this version is set to ***2cb00388f2110209ccb15e8ec3ab5835***

![](hello_bonjur-WSO.png)

## Command type 1
Is running every ~4 mins. Returns the content of the file ***sha1(basename($contentPath))*** encoded in base64. Example:
Content of the file:
```
{"4":7,"2":1,"0":2}
```
Those values represents the counts on the victims per platform (by looking at the user agent of the requestors):

| const PLATFORM | Value |
| ------------- |-------------:|
| UNKNOWN | 0 |
| ANDROID | 1 |
| APPLE | 2 |
| LINUX | 3 |
| WINDOWS | 4 |

Returned string:
```
[RST]eyI0Ijo3LCIyIjoxLCIwIjoyfQ==[/RST]
```
## Command type 2
Is running every ~5 mins. Updates the ***.htaccess*** and the ***index.php*** files that contains the payload. Returns the status of the operation in base64. Example:
```
[RST]eyJzdGF0dXMiOi0xfQ==[/RST]
```
Because the WebShell run the commands being send right away, they don't have to let any IPs related to the actual C2 in a file on disk.

## Who's sending those POST queries ?
I think the clients issuing POST queries to infected WordPress are also infected. Anyways, here are the IPs observed (on ***many*** occasions):
* 5.39.91.110
* 83.172.132.27
* 178.128.33.106
* 173.249.16.143
* 128.199.247.176
* 37.187.20.215
* 142.93.204.172
* 162.243.158.154
* 212.68.198.234

All POST queries seen had this user agent set: **Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0**.

The header of the requests also contains **X-HTTPS : 1**, which makes me believe that the requesting hosts are only serving as proxies.

```
User-Agent : Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0
Host : <infected site>
Accept : */*
Referer : https://<infected site>/<path to the webshell>.php
Cookie : <omitted>=<omitted>
Content-Length : 952
Content-Type : application/x-www-form-urlencoded
X-HTTPS : 1
```
